<!DOCTYPE html>
<html>
<head>
    <title>Floating Class Timetable</title>
</head>
<body>

{% for class_name, entries in grouped_entries.items() %}
<h2>Class: {{ class_name }}</h2>

<table border="1">
<tr>
    <th>Day</th>
    <th>Slot</th>
    <th>Subject(s)</th>
    <th>Room(s)</th>
</tr>

{# -------- GROUP BY DAY + SLOT -------- #}
{% set grouped = {} %}
{% for e in entries %}
    {% if e.is_floating %}
        {% set key = e.day ~ '|' ~ e.slot %}
        {% if key not in grouped %}
            {% set _ = grouped.update({key: []}) %}
        {% endif %}
        {% set _ = grouped[key].append(e) %}
    {% endif %}
{% endfor %}

{# -------- DISPLAY GROUPED DATA -------- #}
{% for key, slot_entries in grouped.items() %}
<tr>
    <td>{{ slot_entries[0].day }}</td>
    <td>{{ slot_entries[0].slot }}</td>

    <td>
        {{ slot_entries
            | map(attribute='subject.name')
            | join(' / ')
        }}
    </td>

    <td>
        (
        {{ slot_entries
            | map(attribute='room.name')
            | map('default', '-')
            | join(', ')
        }}
        )
    </td>
</tr>
{% endfor %}

</table>
{% endfor %}

</body>
</html>
